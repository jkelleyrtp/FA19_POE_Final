<!DOCTYPE html>
<html lang="en-gb">
    <head>
        <meta charset="UTF-8">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Olin College Principles of Engineering 2019">
        <meta name="author" content="Jonathan Kelley">
        <title>Multithreaded Framework | Real Steel </title>
        <link rel="stylesheet" href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;site.css"/>
        <link rel="icon" href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;favicon.ico">
    </head>
    <body>

        <header>
            <nav class="">
                <a class="header__logo white" href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;">Real Steel</a>
                <a class="white" href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;" class="nav-link">Docs</a>
                <a class="white" href="https://github.com/jkelleyrtp/FA19_POE_Final/" class="nav-link">GitHub</a>

                <div class="search-container">
                    <input id="search" type="search" placeholder="ðŸ”Ž Search the docs">

                    <div class="search-results">
                        <div class="search-results__items"></div>
                    </div>
                </div>
            </nav>
        </header>

        <div class="content content--reversed">
            

<div class="documentation">
    <aside class="documentation__sidebar">
        <ul>
        
            
            <li>
                <span class="documentation__sidebar__title">Overview</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;overview&#x2F;overview&#x2F;">Overview</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;overview&#x2F;brainstorming&#x2F;">Brainstorming + Inspiration</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;overview&#x2F;budget&#x2F;">Budget</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Software</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;software&#x2F;systems-overview&#x2F;">Software Overview</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;software&#x2F;human-tracking&#x2F;">Human Tracking</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;software&#x2F;inverse-kinematics&#x2F;">Inverse Kinematics</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;software&#x2F;pybulletsimulation&#x2F;">PyBullet Simulation</a>
                        </li>
                    
                        <li class="active">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;software&#x2F;multithreading&#x2F;">Multithreaded Framework</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;software&#x2F;serialoutput&#x2F;">Serial Output</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Hardware</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;hardware&#x2F;highlevel&#x2F;">High Level Design</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;hardware&#x2F;base&#x2F;">Base Design</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;hardware&#x2F;torso&#x2F;">Torso Design</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;hardware&#x2F;shoulder&#x2F;">Shoulder Design</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;hardware&#x2F;arm&#x2F;">Arm Design</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;hardware&#x2F;assembly&#x2F;">Assembly</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Electrical and Firmware</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;ece&#x2F;firmware&#x2F;">Firmware Overview</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;ece&#x2F;sensors&#x2F;">Sensors</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;documentation&#x2F;ece&#x2F;controls&#x2F;">Controls and Feedback</a>
                        </li>
                    
                </ul>
            </li>
        
        </ul>
    </aside>
    <div class="documentation__content">
        
    <h1>Multithreaded Framework</h1>
    <h2 id="multithreaded-framework"><a class="zola-anchor" href="#multithreaded-framework" aria-label="Anchor link for: multithreaded-framework">ðŸ”—</a>Multithreaded Framework</h2>
<p>In order to perform the skeleton tracking, joint solving, visualizations, and communication all together  simultaneously, we set up a multithreaded framework centered around python's multiprocessing Queues. In our framework, we use two queues: an input queue and a device/output queue. </p>
<p>The input queue gets Kinect joint information pushed into it at every frame. The other systems, inverse kinematics and visualizations, pop joint information off of this queue as long as it's not empty for processing.</p>
<p>The device queue gets robot joint angles pushed into it at every iteration of the main robot loop and communicates these angles over serial whenever they are available.</p>
<pre style="background-color:#383838;">
<span style="font-style:italic;color:#3bc0f0;">def </span><span style="color:#ffc66d;">main_loop</span><span style="color:#e6e1dc;">(</span><span style="font-style:italic;color:#fd971f;">self</span><span style="color:#e6e1dc;">):
	</span><span style="color:#95815e;"># Set up a shared queue to put human angles into
	</span><span style="color:#e6e1dc;">input_queue </span><span style="color:#cc7833;">= </span><span style="color:#e6e1dc;">Queue()
	
	
	</span><span style="color:#95815e;"># Get the process for the input method and start it
	</span><span style="color:#e6e1dc;">input_proc </span><span style="color:#cc7833;">= </span><span style="color:#d0d0ff;">self</span><span style="color:#e6e1dc;">.joint_input.launch(input_queue)
	input_proc.start()
	
	</span><span style="color:#95815e;"># Set up the device queue to push data into
	</span><span style="color:#e6e1dc;">device_queue </span><span style="color:#cc7833;">= </span><span style="color:#e6e1dc;">Queue()
	device_proq </span><span style="color:#cc7833;">= </span><span style="color:#d0d0ff;">self</span><span style="color:#e6e1dc;">.device.launch(device_queue)
	device_proq.start()
	
	</span><span style="color:#95815e;"># Set the initial joint angles
	</span><span style="color:#e6e1dc;">joints </span><span style="color:#cc7833;">= </span><span style="color:#e6e1dc;">{}
	joint_angles </span><span style="color:#cc7833;">= </span><span style="color:#e6e1dc;">[</span><span style="color:#a5c261;">1</span><span style="color:#e6e1dc;">, </span><span style="color:#a5c261;">1</span><span style="color:#e6e1dc;">]
	
	</span><span style="color:#cc7833;">while </span><span style="color:#6e9cbe;">True</span><span style="color:#e6e1dc;">:
		</span><span style="color:#95815e;"># Check if there&#39;s a new human joint inputs ready
		# if not input_queue.empty():
		</span><span style="color:#e6e1dc;">joints </span><span style="color:#cc7833;">= </span><span style="color:#e6e1dc;">input_queue.get()
		</span><span style="color:#cc7833;">if </span><span style="color:#e6e1dc;">joints[</span><span style="color:#a5c261;">&#39;Lwri&#39;</span><span style="color:#e6e1dc;">]:
			joint_angles </span><span style="color:#cc7833;">= </span><span style="color:#d0d0ff;">self</span><span style="color:#e6e1dc;">.solver.solve(joints[</span><span style="color:#a5c261;">&#39;Lwri&#39;</span><span style="color:#e6e1dc;">][</span><span style="color:#a5c261;">&#39;pc&#39;</span><span style="color:#e6e1dc;">])
	
			joint </span><span style="color:#cc7833;">= </span><span style="color:#e6e1dc;">ArmJoints(joint_angles[</span><span style="color:#a5c261;">0</span><span style="color:#e6e1dc;">], joint_angles[</span><span style="color:#a5c261;">1</span><span style="color:#e6e1dc;">], </span><span style="color:#a5c261;">0.0</span><span style="color:#e6e1dc;">)
	
			device_queue.push(joint)
</span></pre>
<p>This architecture is the exact same architecture used in microprocessors and the technique is known as &quot;pipelining.&quot; Just by properly designing the architecture of our code, we saw up to 60-80% performance improvement which was crucial for real time actuation.</p>
<center>
    <img src="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;processed_images&#x2F;1042674e0b71446200.png" />
</center>


    </div>
</div>

        </div>
        <footer>
            Â©2017-2019 â€” <a class="white" href="https://jonathan-kelley.com">Jonathan Kelley</a> and <a class="white" href="https://github.com/jkelleyrtp/FA19_POE_Final/graphs/contributors">contributors</a>
        </footer>

        <script type="text/javascript" src="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;elasticlunr.min.js"></script>
        <script type="text/javascript" src="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;search_index.en.js"></script>
        <script type="text/javascript" src="https:&#x2F;&#x2F;jonathan-kelley.com&#x2F;FA19_POE_Final&#x2F;search.js"></script>
    </body>
</html>
